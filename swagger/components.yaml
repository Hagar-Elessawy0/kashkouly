securitySchemes:
  BearerAuth:
    type: http
    scheme: bearer
    bearerFormat: JWT
    description: JWT access token obtained from login or register endpoint
parameters:
  PageQuery:
    name: page
    in: query
    description: Page number for pagination
    schema:
      type: integer
      minimum: 1
      default: 1
  LimitQuery:
    name: limit
    in: query
    description: Number of items per page
    schema:
      type: integer
      minimum: 1
      maximum: 100
      default: 10
  IdPath:
    name: id
    in: path
    description: Resource ID
    required: true
    schema:
      type: string
      pattern: ^[0-9a-fA-F]{24}$
  TokenQuery:
    name: token
    in: query
    description: Token string
    required: true
    schema:
      type: string
      minLength: 1
  RefreshTokenCookie:
    name: refreshToken
    in: cookie
    description: Refresh token (automatically sent from browser cookies)
    required: true
    schema:
      type: string
schemas:
  SuccessResponse:
    type: object
    properties:
      success:
        type: boolean
        example: true
      message:
        type: string
      data:
        type: object
      meta:
        type: object
        properties:
          timestamp:
            type: string
            format: date-time
          environment:
            type: string
    required:
      - success
      - message
      - meta
  ErrorResponse:
    type: object
    properties:
      success:
        type: boolean
        example: false
      message:
        type: string
      error:
        type: object
        properties:
          code:
            type: string
          details:
            type: object
      meta:
        type: object
        properties:
          timestamp:
            type: string
            format: date-time
          environment:
            type: string
    required:
      - success
      - message
      - error
      - meta
  PaginationMeta:
    type: object
    properties:
      timestamp:
        type: string
        format: date-time
      environment:
        type: string
      page:
        type: integer
      limit:
        type: integer
      totalPages:
        type: integer
      totalItems:
        type: integer
      hasNextPage:
        type: boolean
      hasPrevPage:
        type: boolean
    required:
      - timestamp
      - page
      - limit
      - totalPages
      - totalItems
  Avatar:
    type: object
    properties:
      secure_url:
        type: string
        format: uri
      public_id:
        type: string
        nullable: true
    required:
      - secure_url
  User:
    type: object
    properties:
      id:
        type: string
        example: 507f1f77bcf86cd799439011
      name:
        type: string
        minLength: 2
        maxLength: 50
        example: John Doe
      email:
        type: string
        format: email
        example: john.doe@example.com
      role:
        type: string
        enum:
          - admin
          - instructor
          - student
        example: student
      isEmailVerified:
        type: boolean
        example: false
      isBanned:
        type: boolean
        example: false
      avatar:
        $ref: '#/schemas/Avatar'
      lastLogin:
        type: string
        format: date-time
        nullable: true
      createdAt:
        type: string
        format: date-time
      updatedAt:
        type: string
        format: date-time
    required:
      - id
      - name
      - email
      - role
      - isEmailVerified
      - isBanned
      - createdAt
      - updatedAt
  RegisterDTO:
    type: object
    properties:
      name:
        type: string
        minLength: 2
        maxLength: 50
        example: John Doe
      email:
        type: string
        format: email
        example: john.doe@example.com
      password:
        type: string
        minLength: 8
        pattern: ^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$
        description: Must contain at least one uppercase letter, one lowercase letter, and one number
        example: Password123
      confirmPassword:
        type: string
        description: Must match password
        example: Password123
      role:
        type: string
        enum:
          - admin
          - instructor
          - student
        default: student
        example: student
    required:
      - name
      - email
      - password
      - confirmPassword
  LoginDTO:
    type: object
    properties:
      email:
        type: string
        format: email
        example: john.doe@example.com
      password:
        type: string
        example: Password123
    required:
      - email
      - password
  ForgotPasswordDTO:
    type: object
    properties:
      email:
        type: string
        format: email
        example: john.doe@example.com
    required:
      - email
  ResetPasswordDTO:
    type: object
    properties:
      newPassword:
        type: string
        minLength: 8
        pattern: ^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$
        description: Must contain at least one uppercase letter, one lowercase letter, and one number
        example: NewPassword123
      confirmNewPassword:
        type: string
        description: Must match newPassword
        example: NewPassword123
    required:
      - newPassword
      - confirmNewPassword
  UpdateUserDTO:
    type: object
    properties:
      name:
        type: string
        minLength: 2
        maxLength: 50
        example: John Doe
      email:
        type: string
        format: email
        example: john.doe@example.com
      avatar:
        type: string
        format: binary
        description: User profile picture (image file)
    description: All fields are optional
  EducationStage:
    type: string
    enum:
      - primary
      - secondary
      - higher
    example: secondary
  Student:
    type: object
    properties:
      id:
        type: string
        example: 507f1f77bcf86cd799439011
      user:
        type: object
        properties:
          id:
            type: string
          name:
            type: string
          email:
            type: string
          isEmailVerified:
            type: boolean
          avatar:
            $ref: '#/schemas/Avatar'
      stage:
        $ref: '#/schemas/EducationStage'
      enrolledCourses:
        type: array
        items:
          type: string
      grades:
        type: object
        additionalProperties:
          type: number
      progress:
        type: number
        minimum: 0
        maximum: 100
      parentPhone:
        type: string
      createdAt:
        type: string
        format: date-time
      updatedAt:
        type: string
        format: date-time
    required:
      - id
      - user
      - stage
      - createdAt
      - updatedAt
  UpdateStudentProfileDTO:
    type: object
    properties:
      stage:
        $ref: '#/schemas/EducationStage'
      parentPhone:
        type: string
  StudentList:
    type: object
    properties:
      students:
        type: array
        items:
          $ref: '#/schemas/Student'
      pagination:
        $ref: '#/schemas/PaginationMeta'
responses:
  BadRequest:
    description: Invalid input or validation error
    content:
      application/json:
        schema:
          $ref: '#/schemas/ErrorResponse'
  Unauthorized:
    description: Authentication failed or token missing
    content:
      application/json:
        schema:
          $ref: '#/schemas/ErrorResponse'
  Forbidden:
    description: Insufficient permissions
    content:
      application/json:
        schema:
          $ref: '#/schemas/ErrorResponse'
  NotFound:
    description: Requested resource not found
    content:
      application/json:
        schema:
          $ref: '#/schemas/ErrorResponse'
  InternalServerError:
    description: Unexpected server error
    content:
      application/json:
        schema:
          $ref: '#/schemas/ErrorResponse'
